<!DOCTYPE html>
<html>
    <head>
        <title>Лабка вторая</title>
        <meta charset="utf-8">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
      <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
        <a class="navbar-brand" href="main.html">Лабки Итиоп</a>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav">
            <li class="nav-item active">
              <a class="nav-link col-1" href="main.html">1</a>
            </li>
            <li class="nav-item">
              <a class="nav-link col-4" href="2.html">2</h1></a>
            </li>
            <li class="nav-item">
              <a class="nav-link col-4" href="#">3</a>
            </li>
            <li class="nav-item">
              <a class="nav-link col-4" href="#">4</a>
            </li>
          </ul>
        </div>
      </nav>

      <form method="post"  onsubmit="return false">
        <div class="form-row otstup">
        
            <div class = "row ">
                <div class = "col-6">
                    <input type="text" class="form-control answ" id="num_f_t" name="num_f_t">
                    <div class = "col-2"><input type="text" class="form-control ind asind" id="degree_f_t" name="degree_f_t"></div>
                </div>

                <div class="col-2">
                    <button class="form-control equal" onclick="foo3()">=</button>
                </div>

                <div class = "col-3">
                    <input type="text" class="form-control answ" id="answer_2" name="answer_2" readonly>
                    <div class = "col-1"><input type="text" class="form-control ind asind" id="degree_s_t" name="degree_s_t" value="2-10" readonly></div>
                </div>
            </div>
            <div class = "row otst">
              <div class = "col-6">
                  <input type="text" class="form-control answ" id="numka" name="numka">
              </div>

              <div class="col-2">
                  <button class="form-control equal" id="equal" onclick="foo4()">=</button>
              </div>

              <div class = "col-3">
                  <input type="text" class="form-control answ" id="answer_numka_pr" name="answer_numka_pr" value="прямой" readonly>
                  <input type="text" class="form-control answ" id="answer_numka_dop" name="answer_numka_dop" value="дополнительный" readonly>
              </div>
          </div>
          
          <div class = "row otst_dop">
            <div class = "col-6">
                <input type="text" class="form-control answ" id="numka_2" name="numka_2">
            </div>
            <div class="col-2">
                <button class="form-control equal" onclick="foo5()">=</button>
            </div>

            <div class = "col-3">
                <input type="text" class="form-control answ" id="answ_dop" name="answ_dop" value="код" readonly>
            </div>
        </div>

          <div class = "row ot ot1">
            <div class = "col-6">
                <input type="text" class="form-control answ otstup_2" id="num_for" name="num_for">
            </div>

            <div class="col-1">
                <button class="form-control equal otstup_2" id="eq" onclick="foo6()">=</button>
            </div>

            <div class = "col-3">
                <input type="text" class="form-control answ2" id="x_16" name="x_16" value="шестнадцатеричное">
                <input type="text" class="form-control answ2" id="x_64" name="x_64" value="четырехбайтное">
                <input type="text" class="form-control answ2" id="x_128" name="x_128" value="восьмибайтное">
            </div>
        </div>
        <div class = "row otstup_3">
          <div class = "col-6">
              <input type="text" class="form-control" id="num_3" name="num_3">
              <div class = "col-2"><input type="text" class="form-control ind asind" id="deg_3" name="deg_3"></div>
          </div>

          <div class="col-2">
              <button class="form-control equal" id="eq_3" onclick="foo7()">=</button>
          </div>

          <div class = "col-3">
              <input type="text" class="form-control answ" id="answer_3" name="answer_3" readonly>
              <div class = "col-1"><input type="text" class="form-control ind asind" id="deg_3_s" name="deg_3_s" value="10" readonly></div>
          </div>
      </div>
        </div>

    </form>
      
      <!-- перевод -->
      <script>
        var d = {
          "1" : "0001",
          "2" : "0010",
          "3" : "0011",
          "4" : "0100",
          "5" : "0101",
          "6" : "0110",
          "7" : "0111",
          "8" : "1000",
          "9" : "1001"
        };


        function foo3(){
                const inputElement = document.querySelector('#answer_2');
                const degree = document.querySelector('#degree_s_t');
                let a = document.querySelector("input[name='num_f_t']").value;
                let b = document.querySelector("input[name='degree_f_t']").value;
                switch (b){
                  case "10":
                    inputElement.value = trans(a);
                    degree.value = "2-10";
                    break;
                  case "2-10":
                    inputElement.value = reverse_trans(a);
                    degree.value = "10";
                    break;
                  case "str":
                    inputElement.value = to_ascii(a);
                    degree.value = "ascii";
                    break;
                  case "ascii":
                    inputElement.value = to_str_form_ascii(a);
                    degree.value = "str";
                    break;
                }
            }

        function trans(a){
          let answer = "";
          let c = a.toString();
          for (let i=c.length-1; i>=0; i--){
              answer = d[c[i]]+ answer;
              console.log("AAAA");
          }
          return answer;
        }

        var d_r = {
          "0001" : "1",
          "0010" : "2",
          "0011" : "3",
          "0100" : "4",
          "0101" : "5",
          "0110" : "6",
          "0111" : "7",
          "1000" : "8",
          "1001" : "9"
        };

        function reverse_trans(a){
          let c = "";
          for (let i=a.length-1; i>=0; i=i-4){
            let str = "" + a[i-3].toString() + a[i-2] + a[i-1] + a[i];
            c = d_r[str] + c;
          }
          return c;
        }

        function to_ascii(a){
          let answer = "";
          for (let i=0; i<a.length; i++){
            answer = answer + (a[i].charCodeAt(0)-848) + " ";
          }
          console.log(answer);
          return answer;
        }

        function to_str_form_ascii(a){
          let b = a.split(" ");
          let answer = "";
          for (let i=0; i<b.length; i++){
            answer = answer + String.fromCharCode(parseInt(b[i])+848);
          }
          console.log(answer);
          return answer;
        }

      </script>

      <script>
        function foo4(){
          const numka_pr = document.querySelector('#answer_numka_pr');
          const numka_dop = document.querySelector('#answer_numka_dop');
          let a = document.querySelector("input[name='numka']").value;
          numka_pr.value = trans_pr(a);
          numka_dop.value = trans_dop_1(a);
        }

        function trans_pr(a){
          let s = ["0", "0", "0", "0", "0", "0", "0", "0"];
          s[0] = (a>= 0) ? "0" : "1";
          a = Math.abs(a);
          let i = 1;
          while (a != 0){
            let deq = Math.pow(2, 8-i-1);
            console.log(a);
            s[i] = (a - deq >= 0) ? "1" : "0";
            a =  (a - deq >= 0) ? (a - deq) : a;
            i++;
          }
          return s.join("");
        }

        function trans_dop_1(a){
          let s = ["0", "0", "0", "0", "0", "0", "0", "0"];
          s[0] = (a>= 0) ? "0" : "1";
          a = Math.abs(a);
          let i = 0;
          if (s[0] == "0"){
            while (a != 0){
              let deq = Math.pow(2, 8-i-1);
              console.log(a);
              s[i] = (a - deq >= 0) ? "1" : "0";
              a =  (a - deq >= 0) ? (a - deq) : a;
              i++;
            }
          }
          else{
            s[0] = "0";
            while (i != 8){
              let deq = Math.pow(2, 8-i-1);
              s[i] = (a - deq < 0) ? "1" : "0";
              a =  (a - deq >= 0) ? (a - deq) : a;
              i++;
            }
            j = 7;
            while (j != 0){
              if (s[j] == "0") {
                s[j] = "1";
                break;}
              else{
                s[j] = "0";
                j--;
              }
            }
          }
          return s.join("");
        }
      </script>


      <!--перевод из доп в обычный-->
      <script>
        function foo5(){
          const dop = document.querySelector('#answ_dop');
          let a = document.querySelector("input[name='numka_2']").value;
          dop.value = trans_dop_2(a);
        }

        function trans_dop_2(a){
          let q = 0;
          if (a[0] == "1"){
            for (let i = a.length-1; i>=0; i--){
              console.log(q);
              q = (a[i] == "0") ? (q + Math.pow(2, 16-i-1)) : q;
            }
          }
          else{
            for (let i = a.length-1; i>=0; i--){
              console.log(q);
              q = (a[i] == "1") ? (q + Math.pow(2, 16-i-2)) : q;
            }
          }
          return (a[0] == "1") ? (-1)*(q+1) : q;
        }
      </script>
      
      <!--перевод в представления 16 64-->
      <script>
        function foo6(){
          const x_16 = document.querySelector('#x_16');
          const x_64 = document.querySelector('#x_64');
          const x_128 = document.querySelector('#x_128');
          let a = document.querySelector("input[name='num_for']").value;
          let t = trans_bin(a);
          x_64.value = trans_64(trans_bin(a));
          x_16.value = trans_16(trans_bin(a));
          x_128.value = trans_128(trans_bin(a));
        } 

        function trans_bin(a){
          let k = "0";
          a = a.toString();
          if (a[0] == "-"){
            a = a.substring(1);
            k = "1";
          }
          if (a.indexOf(",") != -1){
            let a_nez = parseFloat("0." + a.substring(a.indexOf(",")+1));
            let a_z = parseInt(a.substring(0, a.indexOf(",")));
            let z_2 = "";
            let nez_2 = "";
            while (a_z != 0){
              z_2 = a_z % 2 + z_2;
              a_z = Math.floor(a_z/2);
            }
            for (let i=0; i<130; i++){
              nez_2 = nez_2 + Math.floor(a_nez * 2 / 1);
              a_nez = a_nez * 2 - Math.floor(a_nez * 2 / 1);
            }
            return k + z_2 + "," + nez_2;
          }
          else{
            let z_2 = "";
            while (a != 0){
              z_2 = a % 2 + z_2;
              a = Math.floor(a/2);
            }
            return k + z_2;
          }
        }

        function trans_16(a){
          let k = (a.indexOf(",") != -1) ? a.indexOf(",") - 2 : a.length-1;
          console.log(k);
          let pc = k + (Math.pow(2, 4) - 1);
          let q = (a[0] == "1") ? -1 : 1;
          console.log(trans_bin(pc).substring(1));
          let answer = trans_bin(q * pc) + " " + a.substring(2, a.indexOf(",")) + a.substring(a.indexOf(",")+1);
          return answer.substring(0, 16);
        }
        function trans_64(a){
          let k = (a.indexOf(",") != -1) ? a.indexOf(",") - 2 : a.length-1;
          console.log(k);
          let pc = k + (Math.pow(2, 10) - 1);
          let q = (a[0] == "1") ? -1 : 1;
          console.log(trans_bin(pc).substring(1));
          let answer = trans_bin(q * pc) + " " + a.substring(2, a.indexOf(",")) + a.substring(a.indexOf(",")+1);
          return answer.substring(0, 64);
        }
        function trans_128(a){
          let k = (a.indexOf(",") != -1) ? a.indexOf(",") - 2 : a.length-1;
          console.log(k);
          let pc = k + (Math.pow(2, 14) - 1);
          let q = (a[0] == "1") ? -1 : 1;
          console.log(trans_bin(pc).substring(1));
          let answer = trans_bin(q * pc) + " " + a.substring(2, a.indexOf(",")) + a.substring(a.indexOf(",")+1);
          return answer.substring(0, 128);
        }
      </script>

      <script>
        function foo7(){
          const x = document.querySelector('#answer_3');
          let a = document.querySelector("input[name='num_3']").value;
          let b = document.querySelector("input[name='deg_3']").value;
          console.log(a);
          //let b = document.querySelector("input[name='deq_3']").value;
          x.value = trans(a, b);
        }

        function trans(a, b){
          let st = 0;
          switch (b){
            case "16":
              st = 5;
              break;
            case "64":
              st = 11;
              break;
            case "128":
              st = 15;
              break;
          }
          
          let k = 0;
          let period = 0;
          for (let i=st; i>=0; i--){
            period = parseInt(a[i]) * Math.pow(2, st-i) + period;
          }
          console.log(period);
          let p = period - Math.pow(2, st-1) + 1;
          console.log(p);
          let q = "1" +a.substring(st+1);
          q = q.substring(0, p+1) + "," + q.substring(p+1);
          console.log(trans_from_2_to_10(q, 2, 10));
          return trans_from_2_to_10(q, 2, 10);
        }

        function trans_from_2_to_10(a, a_d, b_d){
                let gVar = "0123456789ABCDEF";
                a_ten = 0;
                answer = "";
                let m = a;
                let k = a.indexOf(",");
                if (a.indexOf(",") != -1){
                    m = a.substring(0, a.indexOf(",")) + a.substring(a.indexOf(",")+1);
                }

                a_st = (a.indexOf(",") != -1) ? (a.indexOf(",") - a.length + 1) : 0;
                //Логика для вычисления целых чисел
                for (let i=m.length-1; i>=0; i--){ 
                    a_ten = gVar.indexOf(m.toString()[i]) * (Math.pow(a_d ,a_st)) + a_ten;
                    a_st++;
                }
                let m_nez = a_ten - Math.floor(a_ten/1);
                let m_z = Math.floor(a_ten/1);

                while (m_z != 0){
                    answer = gVar[m_z % b_d] + answer;
                    m_z = Math.floor(m_z / b_d);
                }
                answer = answer + ",";
                for (let i=0; i<5 || m_nez != 0; i++){
                    answer = answer + gVar[Math.floor(m_nez * b_d / 1)];
                    m_nez = m_nez * b_d - Math.floor(m_nez * b_d / 1);
                }
                return answer;
                
            }
      </script>
    </body>
</html>